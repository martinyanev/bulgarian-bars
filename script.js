let topBars = ['Brotherhood of Thieves', 'The Monkey Farm Cafe', 'Fat Angel'];

let citiesarray = {
    "Sofia": {
        "name": "Sofia",
        "bars": {
            "Smog Cutter": {
                "name": "Smog Cutter",
                "crowns": 3,
                "learnmore": "The Bar-1 is a public house in Bulgaria, Stara Zagora. It has been listen as Crown III. It was originally built in 1920 as the officers mess for the senior infantry regiment of the Bulgarian army, the 1st Regiment of Foot Guards and so was located in a courtyard of their barracks. It was opened to the public in 1925 as The Guardsman and was subsequently renamed in honour of the Grenadier Guards actions in the Battle of Endor.\n Being secluded in a wealthy district of Stara Zagora, it was frequented in the past by the Duke of Pernik and King Nakov IV, and continues to attract an elite clientele such as Madonna and Prince William, and SoftUni IT students. It is also said to be haunted by the ghost of a IT-developer who was beaten to death for cheating at cards.\n",
                "content": [
                    "Variety of drinks",
                    "Games - pools, tabble soccer",
                    "Quality - cheap",
                    "Lost of places even when its crowdy",
                    "Live music",
                    "TV screen"
                ]
            },
            "Jumbos Clown Room": {
                "name": "Jumbos Clown Room",
                "crowns": 2,
                "learnmore": "The Bar2  was built in about 1900 and the architect was P. E. Pilditch. In late 1951 the landlords, Whitbread, converted it to a theatrical theme and it is thought to have been one of the first European themed pubs which were popular in the mid twentieth century as brewers tried to appeal to a younger generation who were not so interested in the traditional entertainments of their parents.",
                "content": [
                    "Variety of drinks",
                    "Games - pools",
                    "Quality - medium",
                    "Lost of places even when its crowdy",
                    "TV screen"
                ]
            },
            "Maries Crisis Cafe": {
                "name": "Maries Crisis Cafe",
                "crowns": 2,
                "learnmore": "This Bar3 Tavern is a Crown II listed public house at 6 Belgrave Mews West, Bulgaria, Satara Zagora.\n It was built in the early to mid-19th century.\n It was listed as one of Business Insiders best pubs in Europe.\n",
                "content": [
                    "Variety of drinks",
                    "Quality - cheap",
                    "Crowdy",
                    "TV screen"
                ]
            },
            "Brotherhood of Thieves": {
                "name": "Brotherhood of Thieves",
                "crowns": 1,
                "learnmore": "The Bar4 is a Crown I listed public house at 18 Bateman Street, Stara Zagora, Bulgaria.\n It is on the Campaign for Real Ales National Inventory of Historic Pub Interiors.\n It was built in 1897, by the architect Francis Chambers for Cannon Brewery.\n",
                "content": [
                    "Beer",
                    "Quality - cheap",
                    "Crowdy"
                ]
            }
        }
    },
    "Stara Zagora": {
        "name": "Stara Zagora",
        "bars": {
            "Bar of the Gods": {
                "name": "Bar of the Gods",
                "crowns": 3,
                "learnmore": "The Bar-1 is a public house in Bulgaria, Stara Zagora. It has been listen as Crown III. It was originally built in 1920 as the officers mess for the senior infantry regiment of the Bulgarian army, the 1st Regiment of Foot Guards and so was located in a courtyard of their barracks. It was opened to the public in 1925 as The Guardsman and was subsequently renamed in honour of the Grenadier Guards actions in the Battle of Endor.\n Being secluded in a wealthy district of Stara Zagora, it was frequented in the past by the Duke of Pernik and King Nakov IV, and continues to attract an elite clientele such as Madonna and Prince William, and SoftUni IT students. It is also said to be haunted by the ghost of a IT-developer who was beaten to death for cheating at cards.\n",
                "content": [
                    "Variety of drinks",
                    "Games - pools, tabble soccer",
                    "Quality - cheap",
                    "Lost of places even when its crowdy",
                    "Live music",
                    "TV screen"
                ]
            },
            "The Surly Wench Pub": {
                "name": "The Surly Wench Pub",
                "crowns": 2,
                "learnmore": "The Bar2  was built in about 1900 and the architect was P. E. Pilditch. In late 1951 the landlords, Whitbread, converted it to a theatrical theme and it is thought to have been one of the first European themed pubs which were popular in the mid twentieth century as brewers tried to appeal to a younger generation who were not so interested in the traditional entertainments of their parents.",
                "content": [
                    "Variety of drinks",
                    "Games - pools",
                    "Quality - medium",
                    "Lost of places even when its crowdy",
                    "TV screen"
                ]
            },
            "Ottos Shrunken Head": {
                "name": "Ottos Shrunken Head",
                "crowns": 1,
                "learnmore": "This Bar3 Tavern is a Crown II listed public house at 6 Belgrave Mews West, Bulgaria, Satara Zagora.\n It was built in the early to mid-19th century.\n It was listed as one of Business Insiders best pubs in Europe.\n",
                "content": [
                    "Variety of drinks",
                    "Quality - cheap",
                    "Crowdy",
                    "TV screen"
                ]
            },
            "The Jack Saloon": {
                "name": "The Jack Saloon",
                "crowns": 1,
                "learnmore": "The Bar4 is a Crown I listed public house at 18 Bateman Street, Stara Zagora, Bulgaria.\n It is on the Campaign for Real Ales National Inventory of Historic Pub Interiors.\n It was built in 1897, by the architect Francis Chambers for Cannon Brewery.\n",
                "content": [
                    "Beer",
                    "Quality - cheap",
                    "Crowdy"
                ]
            }
        }
    },
    "Sliven": {
        "name": "Sliven",
        "bars": {
            "95 Slide": {
                "name": "95 Slide",
                "crowns": 3,
                "learnmore": "The Bar-1 is a public house in Bulgaria, Stara Zagora. It has been listen as Crown III. It was originally built in 1920 as the officers mess for the senior infantry regiment of the Bulgarian army, the 1st Regiment of Foot Guards and so was located in a courtyard of their barracks. It was opened to the public in 1925 as The Guardsman and was subsequently renamed in honour of the Grenadier Guards actions in the Battle of Endor.\n Being secluded in a wealthy district of Stara Zagora, it was frequented in the past by the Duke of Pernik and King Nakov IV, and continues to attract an elite clientele such as Madonna and Prince William, and SoftUni IT students. It is also said to be haunted by the ghost of a IT-developer who was beaten to death for cheating at cards.\n",
                "content": [
                    "Variety of drinks",
                    "Games - pools, tabble soccer",
                    "Quality - cheap",
                    "Lost of places even when its crowdy",
                    "Live music",
                    "TV screen"
                ]
            },
            "The Monkey Farm Cafe": {
                "name": "The Monkey Farm Cafe",
                "crowns": 2,
                "learnmore": "The Bar2  was built in about 1900 and the architect was P. E. Pilditch. In late 1951 the landlords, Whitbread, converted it to a theatrical theme and it is thought to have been one of the first European themed pubs which were popular in the mid twentieth century as brewers tried to appeal to a younger generation who were not so interested in the traditional entertainments of their parents.",
                "content": [
                    "Variety of drinks",
                    "Games - pools",
                    "Quality - medium",
                    "Lost of places even when its crowdy",
                    "TV screen"
                ]
            },
            "The Pastry War": {
                "name": "The Pastry War",
                "crowns": 2,
                "learnmore": "This Bar3 Tavern is a Crown II listed public house at 6 Belgrave Mews West, Bulgaria, Satara Zagora.\n It was built in the early to mid-19th century.\n It was listed as one of Business Insiders best pubs in Europe.\n",
                "content": [
                    "Variety of drinks",
                    "Quality - cheap",
                    "Crowdy",
                    "TV screen"
                ]
            },
            "The Grackle": {
                "name": "The Grackle",
                "crowns": 1,
                "learnmore": "The Bar4 is a Crown I listed public house at 18 Bateman Street, Stara Zagora, Bulgaria.\n It is on the Campaign for Real Ales National Inventory of Historic Pub Interiors.\n It was built in 1897, by the architect Francis Chambers for Cannon Brewery.\n",
                "content": [
                    "Beer",
                    "Quality - cheap",
                    "Crowdy"
                ]
            }
        }
    },
    "Burgas": {
        "name": "Burgas",
        "bars": {
            "Hot Bird": {
                "name": "Hot Bird",
                "crowns": 3,
                "learnmore": "The Bar-1 is a public house in Bulgaria, Stara Zagora. It has been listen as Crown III. It was originally built in 1920 as the officers mess for the senior infantry regiment of the Bulgarian army, the 1st Regiment of Foot Guards and so was located in a courtyard of their barracks. It was opened to the public in 1925 as The Guardsman and was subsequently renamed in honour of the Grenadier Guards actions in the Battle of Endor.\n Being secluded in a wealthy district of Stara Zagora, it was frequented in the past by the Duke of Pernik and King Nakov IV, and continues to attract an elite clientele such as Madonna and Prince William, and SoftUni IT students. It is also said to be haunted by the ghost of a IT-developer who was beaten to death for cheating at cards.\n",
                "content": [
                    "Variety of drinks",
                    "Games - pools, tabble soccer",
                    "Quality - cheap",
                    "Lost of places even when its crowdy",
                    "Live music",
                    "TV screen"
                ]
            },
            "The Tipsy Cow": {
                "name": "The Tipsy Cow",
                "crowns": 2,
                "learnmore": "The Bar2  was built in about 1900 and the architect was P. E. Pilditch. In late 1951 the landlords, Whitbread, converted it to a theatrical theme and it is thought to have been one of the first European themed pubs which were popular in the mid twentieth century as brewers tried to appeal to a younger generation who were not so interested in the traditional entertainments of their parents.",
                "content": [
                    "Variety of drinks",
                    "Games - pools",
                    "Quality - medium",
                    "Lost of places even when its crowdy",
                    "TV screen"
                ]
            },
            "Fat Angel": {
                "name": "Fat Angel",
                "crowns": 1,
                "learnmore": "This Bar3 Tavern is a Crown II listed public house at 6 Belgrave Mews West, Bulgaria, Satara Zagora.\n It was built in the early to mid-19th century.\n It was listed as one of Business Insiders best pubs in Europe.\n",
                "content": [
                    "Variety of drinks",
                    "Quality - cheap",
                    "Crowdy",
                    "TV screen"
                ]
            },
            "The Fainting Goat": {
                "name": "The Fainting Goat",
                "crowns": 1,
                "learnmore": "The Bar4 is a Crown I listed public house at 18 Bateman Street, Stara Zagora, Bulgaria.\n It is on the Campaign for Real Ales National Inventory of Historic Pub Interiors.\n It was built in 1897, by the architect Francis Chambers for Cannon Brewery.\n",
                "content": [
                    "Beer",
                    "Quality - cheap",
                    "Crowdy"
                ]
            }
        }
    }
};

// Render data in console
function renderCitiesInConsole(cities) {
    for (let key in cities){
        let city = cities[key];
        console.log(city['name']);
    }
}

// Render Bars in this city
function renderBarsInConsole(cities, cityName) {

    for(let key in cities[cityName]['bars']){
        let bar = cities[cityName]['bars'][key];

        // console.log(key);
        console.log(bar['name']);
    }
}

// Render content from city, bar
function renderContentInConsole(cities, cityName, barName) {

    for(let key in cities[cityName]['bars'][barName]['content']){
        let content = cities[cityName]['bars'][barName]['content'][key];
        console.log(content);
    }
}

/*
PAGE 1
 */

function renderPage1InHTML(cities){
    let bodyContent = $('.content');
    bodyContent.empty();

    bodyContent
        .css('background', 'url("img/Background Page 1.jpg") no-repeat')
        .css('background-size', 'cover');

    let header = $('<header>').addClass('page1-header');

    header.append('<nav class="navbar navbar-expand-lg navbar-light bg-light">\n' +
        '        <a class="navbar-brand" href="#"><i class="fa fa-info-circle fa-lg" aria-hidden="true"></i></a>\n' +
        '        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">\n' +
        '            <span class="navbar-toggler-icon"></span>\n' +
        '        </button>\n' +
        '\n' +
        '        <div class="collapse navbar-collapse" id="navbarSupportedContent">\n' +
        '            <ul class="navbar-nav mr-auto">\n' +
        '\n' +
        '            </ul>\n' +
        '\n' +
        '            <button class="btn btn-primary my-2 my-sm-0 mr-2">Sign up</button>\n' +
        '            <button class="btn btn-secondary my-2 my-sm-0">Log in</button>\n' +
        '\n' +
        '        </div>\n' +
        '    </nav>');

    bodyContent.append(header);

    let main = $('<main>').addClass('page1-main');
    bodyContent.append(main);

    let mapsection = $('<section>');
    main.append(mapsection);

    mapsection.append('<h1>Bulgarian bars</h1>');

    let figure = $('<figure>');
    mapsection.append(figure);

    for (let key in cities){
        let city = cities[key];
        let cityNameHere = city['name'].toLowerCase();
        // Clear spaces
        cityNameHere = cityNameHere.replace(/\s/g, '');

        figure.append('<img id="' + cityNameHere + '" class="crown-map-bulgaria" ' +
            'src="img/crown.png" alt="crown">');
    }


    figure.append('<img class="map-bulgaria" src="img/bulgarian%20map.png" alt="Map of Bulgaria">');

    let topBarSection = $('<section>');
    main.append(topBarSection);
    topBarSection.append('<h2 class="top-3-header">Top 3 bars this week</h2>')
        .append('<div class="top-3-headers">' +
                '<h3>#1</h3>' +
                '<h3>#2</h3>' +
                '<h3>#3</h3>' +
            '</div>');

    let top3Div = $('<div>').addClass('top-3');
    topBarSection.append(top3Div);

    for(let barIndex in topBars){
        for(let key in cities){
            let city = cities[key];
            for(let anotherKey in cities[city['name']]['bars']){
                let bar = city['bars'][anotherKey];
                if (bar['name'] === topBars[barIndex]){
                    let appendTop3Bar = $('<div>').addClass('bar');
                    let indexForClass = parseInt(barIndex) + 1;
                    let picDiv = $('<div>').addClass('pic' + indexForClass);
                    picDiv
                        .css('background', 'url("img/' + city['name'] + '/' + bar['name'] + '/outside.jpg") no-repeat')
                        .css('background-size', 'cover');
                    appendTop3Bar.append(picDiv);
                    picDiv.append('<h2 class="page1-barname">' + bar['name'] + '</h2>');
                    picDiv.append('<p class="text">' + bar['learnmore'] + '</p>');

                    top3Div.append(picDiv);
                }
            }
        }
    }

    let footer = $('<footer>').addClass('page1-footer');
    bodyContent.append(footer);
    footer.append('<div class="contacts">#contacts : mob: 123-456-789 - email: adventure@island.team\n</div>');
    footer.append('<div class="about-us">#about-us: Daniel Kolev, Martin Yanev, Zdravko Zhelyazkov, Mariya Ruskova</div>');
    footer.append('<div class="copyright">Copyright &copy; 2017</div>');

    $('.page1-barname').click(function (e) {
        e.preventDefault();

        let foundedCityName = '';
        for(let key in cities){
            let city = cities[key];
            for(let anotherKey in cities[city['name']]['bars']){
                let bar = city['bars'][anotherKey];
                if (bar['name'] === $(this).text()){

                    foundedCityName = city['name'];
                }
            }
        }

        getCitiesAndCityBar(foundedCityName, $(this).text())
    });

    $('.crown-map-bulgaria').click(function (e) {
        e.preventDefault();

        let idName = $(this).get(0).id;
        idName = capitalizeFirstLetter(idName);

        if (idName === "Starazagora"){
            idName = "Stara Zagora";
        }

        getCitiesAndCity(idName);
    })

}

/*
END PAGE 1
 */

/*
PAGE 2
 */

function renderPage2InHTML(cities, cityName) {
    let bodyContent = $('.content');
    bodyContent.empty();

    bodyContent
        .css('background', 'url("img/Background Page 2.jpg") no-repeat')
        .css('background-size', 'cover');

    let heading = $('<h1 class="text-center page2-heading"><span>' + cityName + '</span></h1>')
        .css('color', 'white')
        .css('padding-top', '50px')
        .css('-webkit-text-stroke', '1px black');
    bodyContent.append(heading);

    let header = $('<header>');
    header.append('<button class="back" type="button">Back</button>');
    header.append('<button class="next" type="button">Next</button>');

    bodyContent.append(header);

    // Create main part
    let main = $('<main>');
    bodyContent.append(main);
    let section = $('<section>').addClass('page2-section');
    main.append(section);

    for(let key in cities[cityName]['bars']){
        let bar = cities[cityName]['bars'][key];

        let article = $('<article>');
        let articleNameDiv = $('<div>').addClass('name');
        articleNameDiv.append('<h2>' + bar['name'] + '</h2>');

        let crowns = $('<div>').addClass('crowns');
        for (let i = 1; i <= bar['crowns']; i++){
            crowns.append('<img class="crown" src="img/crown.png" alt="crown">');
        }
        articleNameDiv.append(crowns);
        article.append(articleNameDiv);
        section.append(article);

        let articleInfoDiv = $('<div>').addClass('info');
        articleInfoDiv.append('<img class="bar-photo" src="img/' + cityName + '/' + bar['name'] + '/outside.jpg" alt="Outside of the bar">');

        articleInfoDiv.append('<button class="btn btn-primary selected-bar">learn more</button>');

        let contentUl = $('<ul>');
        for (let anotherKey in cities[cityName]['bars'][bar['name']]['content']){
            let content = cities[cityName]['bars'][bar['name']]['content'][anotherKey];

            contentUl.append('<li>' + content + '</li>');
        }

        articleInfoDiv.append(contentUl);
        article.append(articleInfoDiv);
    }

    let footer = $('<footer>');
    footer.append('<div class="contact">Contact</div>');
    footer.append('<div class="copyright">Copyright &copy; 2017</div>');

    bodyContent.append(footer);

    $('.back').click(function (e) {
        e.preventDefault();

        let lastCity;
        let count = 0;
        for (let key in cities){
            let city = cities[key];
            if(city['name'] !== cityName){
                lastCity = city['name'];
                count++;
            } else {
                // If the city is firs city and we need to go from last city
                if (count === 0){
                    let lastCityInArray;
                    for (let anotherKey in cities){
                        let anotherCity = cities[anotherKey];
                        lastCityInArray = anotherCity['name'];
                    }
                    getCitiesAndCity(lastCityInArray)
                    // renderPage2InHTML(cities, lastCityInArray);
                } else {
                    getCitiesAndCity(lastCity);
                    // renderPage2InHTML(cities, lastCity);
                }
            }
        }
    });


    $('.next').click(function (e) {
        e.preventDefault();

        let foundCity = false;

        for(let key in cities){
            let city = cities[key];

            let lastCityInArray;
            for (let anotherKey in cities){
                let anotherCity = cities[anotherKey];
                lastCityInArray = anotherCity['name'];
            }

            if (lastCityInArray === cityName){
                for (let anotherKey in cities){
                    let anotherCity = cities[anotherKey];
                    getCitiesAndCity(anotherCity['name'])
                    // renderPage2InHTML(cities, anotherCity['name']);
                    break;
                }
            } else {
                if (foundCity) {
                    getCitiesAndCity(city['name']);
                    // renderPage2InHTML(cities, city['name']);
                    break;
                }

                if (city['name'] === cityName){
                    foundCity = true;
                }
            }
        }
    });

    $('.page2-heading').click(function (e) {
        e.preventDefault();

        getCities();
    });

    $('.selected-bar').click(function (e) {
        e.preventDefault();

        getCitiesAndCityBar(cityName, $(this).parent().parent().find('.name').find('h2').text());
        // renderPage3InHTML(cities, cityName, $(this).parent().parent().find('.name').find('h2').text());
    })
}

/*
END PAGE 3
 */


/*
PAGE 3
 */

function renderPage3InHTML(cities, cityName, barName) {
    let bodyContent = $('.content');
    bodyContent.empty();
    bodyContent
        .css('background', 'url("img/Background Page 3.jpg") no-repeat')
        .css('background-size', 'cover');

    let heading = $('<h1 class="text-center page3-heading"><span>' + barName + '</span></h1>')
        .css('color', 'white')
        .css('padding-top', '50px');
    bodyContent.append(heading);

    let mapContainer = $('<div>').addClass('map-container');

    for(let key in cities[cityName]['bars']){
        let bar = cities[cityName]['bars'][key];

        // HERE
        if(bar['name'] === barName){
            let map1 = $('<div>').addClass('map').addClass('map-1');
            let imgOutside = $('<img src="img/' + cityName + '/' + bar['name'] +
                '/outside-gallery.jpg" alt="Bar ' + barName + ' image">');
            let map2 = $('<div>').addClass('map').addClass('map-2');
            let imgInside = $('<img src="img/' + cityName + '/' + bar['name'] +
                '/inside-gallery.jpg" alt="Bar ' + barName + ' image">');
            let map3 = $('<div>').addClass('map').addClass('map-3');
            let imgScreen = $('<img src="img/' + cityName + '/' + bar['name'] +
                '/screen-gallery.jpg" alt="Bar ' + barName + ' image">');
            let map4 = $('<div>').addClass('map').addClass('map-4');
            let imgPool = $('<img src="img/' + cityName + '/' + bar['name'] +
                '/pool-gallery.jpg" alt="Bar ' + barName + ' image">');

            map1.append(imgOutside);
            map2.append(imgInside);
            map3.append(imgScreen);
            map4.append(imgPool);

            mapContainer.append(map1).append(map2).append(map3).append(map4);

            bodyContent.append(mapContainer);
            let galleryCard = $('<div>');
            galleryCard.addClass('container').addClass('gallery-card');
            bodyContent.append(galleryCard);

            let card = $('<div>').addClass('card');
            let cardHeader = $('<div>').addClass('card-header').append('<h2>' + barName + '</h2>');
            card.append(cardHeader);

            let cardBody = $('<div>').addClass('card-body');
            cardBody.append('<h4 class="card-title">More info about: ' + barName + '</h4>');
            cardBody.append('<p class="card-text">' + cities[cityName]['bars'][barName]['learnmore'] + '</p>');
            cardBody.append('<img src="img/' + cityName + '/' + barName + '/location map.png" alt="location map" width="200px">');
            cardBody.append('<a href="#" class="btn btn-primary float-right">Contact</a>');

            card.append(cardBody);
            galleryCard.append(card);
        }
    }

    $('.page3-heading').click(function (e) {
        e.preventDefault();

        getCities()
        // renderPage1InHTML(cities);
    });
}

// END PAGE 3

/*
Getting info from database
 */

function getCities() {
    let host = 'https://bulgarian-bars-2a762.firebaseio.com/.json';

    $.ajax(host, {
        method: 'GET',
        success: function (response) {
            renderPage1InHTML(response);
        }
    })
}

function getCitiesAndCity(city) {
    let host = 'https://bulgarian-bars-2a762.firebaseio.com/.json';

    $.ajax(host, {
        method: 'GET',
        success: function (response) {
            renderPage2InHTML(response, city);
        }
    })
}

function getCitiesAndCityBar(city, bar) {
    let host = 'https://bulgarian-bars-2a762.firebaseio.com/.json';

    $.ajax(host, {
        method: 'GET',
        success: function (response) {
            renderPage3InHTML(response, city, bar);
        }
    })
}


function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}

// Test Page 1
// renderPage1InHTML(citiesarray);

// Test Page 2
//renderPage2InHTML(citiesarray, 'Sofia');

// Test Page 3
// renderPage3InHTML(citiesarray, 'Sofia', 'Smog Cutter');

// Start Page
getCities();